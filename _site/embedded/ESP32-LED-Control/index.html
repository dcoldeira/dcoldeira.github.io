<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>ESP32 LED Control - YachtCraft Chronicles</title>
<meta name="description" content="This project shows some of the features of the powerful ESP32 microcontroller. Starting with a simple LED circuit, we demonstrate how to control it using code and how to toggle it on and off with a push button. We then use pulse-width modulation (PWM) to control the LED’s brightness and create various lighting effects.">


  <meta name="author" content="David Coldeira">
  
  <meta property="article:author" content="David Coldeira">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="YachtCraft Chronicles">
<meta property="og:title" content="ESP32 LED Control">
<meta property="og:url" content="http://localhost:4000/embedded/ESP32-LED-Control/">


  <meta property="og:description" content="This project shows some of the features of the powerful ESP32 microcontroller. Starting with a simple LED circuit, we demonstrate how to control it using code and how to toggle it on and off with a push button. We then use pulse-width modulation (PWM) to control the LED’s brightness and create various lighting effects.">







  <meta property="article:published_time" content="2023-02-10T00:00:00+00:00">





  

  


<link rel="canonical" href="http://localhost:4000/embedded/ESP32-LED-Control/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "David Coldeira",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="YachtCraft Chronicles Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/icon.png" alt="YachtCraft Chronicles"></a>
        
        <a class="site-title" href="/">
          YachtCraft Chronicles
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">David Coldeira</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Dive into marine engineering, electricals, and the art of crafting classic sailboats. Explore innovative technologies, techniques, and the allure of yacht craftsmanship. Join us on a captivating journey through the seas of yacht engineering</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="ESP32 LED Control">
    <meta itemprop="description" content="This project shows some of the features of the powerful ESP32 microcontroller. Starting with a simple LED circuit, we demonstrate how to control it using code and how to toggle it on and off with a push button. We then use pulse-width modulation (PWM) to control the LED’s brightness and create various lighting effects.">
    <meta itemprop="datePublished" content="2023-02-10T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/embedded/ESP32-LED-Control/" class="u-url" itemprop="url">ESP32 LED Control
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          12 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <p>This project shows some of the features of the powerful ESP32 microcontroller. Starting with a simple LED circuit, we demonstrate how to control it using code and how to toggle it on and off with a push button. We then use pulse-width modulation (PWM) to control the LED’s brightness and create various lighting effects.</p>

<p>Next, we explore the ESP32’s Wi-Fi capabilities and create a web interface that allows us to control the LED remotely. Finally, we take our project to the next level by creating a Flutter app that communicates with the ESP32 via Wi-Fi and enables us to control the LED from our mobile device.</p>

<h1 id="11-materials">1.1 Materials</h1>

<p>To complete this project, I used the following materials:</p>

<ul>
  <li>An ESP32 development board</li>
  <li>A breadboard</li>
  <li>A 5mm LED (any color)</li>
  <li>A 220-ohm resistor</li>
  <li>Jumper wires</li>
</ul>

<p align="center">
  <img src="/assets/images/post1/1.jpg" width="250" height="250" />
</p>

<h1 id="12-circuit-diagram">1.2 Circuit Diagram</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                     +------------------+
                     |                  |
                     |    ESP32 Board   |
                     |                  |
                     +------------------+
                              |
                              |
                              |
                              |                             
                     +------------------+
                     |                  |
                     |        LED       |
                     |                  |
                     +------------------+
                              |
                              |
                             ---
                              |
                             GND
</code></pre></div></div>
<p>Everything was connected as per the diagram above, pin 2 was used on the ESP32 board.</p>

<p align="center">
  <img src="/assets/images/post1/2.jpg" width="250" height="250" />
</p>

<h1 id="13-arduino-ide">1.3 Arduino IDE</h1>

<p>To use the ESP32 with Arduino IDE, the ESP32 board support package is needed. Here are the steps I followed:</p>

<ol>
  <li>Opened the Arduino IDE.</li>
  <li>Clicked on File &gt; Preferences.</li>
  <li>In the Additional Boards Manager URLs field, entered the following URL: <code class="language-plaintext highlighter-rouge">https://dl.espressif.com/dl/package_esp32_index.json</code>.</li>
  <li>Clicked on OK to close the Preferences window.</li>
  <li>Went to Tools &gt; Board &gt; Boards Manager.</li>
  <li>Typed “esp32” in the search bar and installed “esp32 by Espressif Systems”.</li>
  <li>Went to Tools &gt; Board and select the ESP32 board.</li>
  <li>Just needed to write and upload the code to the ESP32 board using the Arduino IDE.</li>
</ol>

<h1 id="14-programming">1.4 Programming</h1>

<p>C++ was used to program the ESP32 microcontroller. The code is simple and straightforward. Here is a brief overview of the code:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Define the LED pin number</span>
<span class="cp">#define LED_PIN 2
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set the LED pin as an output pin</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Turn the LED on</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  
  <span class="c1">// Turn the LED off</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p>In the first line of code, we use the #define directive to define the LED pin number as a constant variable called LED_PIN. In this case, we set it to pin 2.</p>

<p>In the setup() function, we set the LED_PIN as an output pin using the pinMode() function.</p>

<p>In the loop() function, we first turn the LED on by setting the LED_PIN output to HIGH using the digitalWrite() function, then we use the delay() function to wait for one second before turning it off again by setting the LED_PIN output to LOW. We then wait another second before repeating the cycle.</p>

<p>So the code turns the LED on and off every second indefinitely.</p>

<p><em>To add a push button to toggle the LED, we will need:</em></p>

<h1 id="21-aditional-materials">2.1 Aditional materials</h1>

<ul>
  <li>Push button</li>
</ul>

<h1 id="22-circuit-diagram">2.2 Circuit Diagram</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                     +------------------+
                     |                  |
                     |    ESP32 Board   |
                     |                  |
                     +------------------+
                              |
                     +--------+---------+
                     |        |         |
                     |        |         |
                    +--+     ---       ---
                    |  |     ---       ---
                    |  |      |         |
                    |  |      |         |
                    |  |      |         |
                    |  |      |         |
                    |  |      |         |
                    |  |      |         |
                    |  |      |         |
                    +--+      |         |
                              |         |
                              |         |
                              |         |
                              |         
                              |
                              |
                              |
                              |
                     +------------------+
                     |                  |
                     |        LED       |
                     |                  |
                     +------------------+
                              |
                              |
                             ---
                              |
                             GND

</code></pre></div></div>

<p align="center">
  <img src="/assets/images/post1/3.jpg" width="250" height="250" />
</p>

<p>We Connect one leg of the push button to pin 3 of the ESP32 and the other leg to ground. The LED stays connected as in the previous section.</p>

<h1 id="23-arduino-ide">2.3 Arduino IDE</h1>

<p>In the Arduino IDE, we need to define the pin numbers for the LED and the push button. Here is the code to do that:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Define the LED and button pin numbers</span>
<span class="cp">#define LED_PIN 2
#define BUTTON_PIN 3
</span></code></pre></div></div>

<h1 id="24-programming">2.4 Programming</h1>

<p>In the setup() function, we need to set the BUTTON_PIN as an input pin using the pinMode() function:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set the LED pin as an output pin</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="c1">// Set the button pin as an input pin</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">BUTTON_PIN</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>In the loop() function, we can use the digitalRead() function to read the state of the BUTTON_PIN. If the button is pressed, the LED should toggle its state. Here is the code:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Read the state of the button</span>
  <span class="kt">int</span> <span class="n">reading</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">BUTTON_PIN</span><span class="p">);</span>

  <span class="c1">// Check if the button state has changed</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">reading</span> <span class="o">!=</span> <span class="n">lastButtonState</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Reset the debounce timer</span>
    <span class="n">lastDebounceTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Check if the debounce delay has passed</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">lastDebounceTime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">debounceDelay</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Check if the button state has stabilized</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reading</span> <span class="o">!=</span> <span class="n">buttonState</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">buttonState</span> <span class="o">=</span> <span class="n">reading</span><span class="p">;</span>
      <span class="c1">// If the button has been pressed, toggle the LED</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">buttonState</span> <span class="o">==</span> <span class="n">LOW</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="o">!</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Update the last button state</span>
  <span class="n">lastButtonState</span> <span class="o">=</span> <span class="n">reading</span><span class="p">;</span>

  <span class="c1">// Flash the LED if it is on</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">)</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>In the above code, we first read the state of the BUTTON_PIN using the digitalRead() function and store it in the variable buttonState.</p>

<p>If the button is pressed (i.e., the buttonState is HIGH), we toggle the state of the LED using the digitalWrite() function and the ! operator to invert the current state of the LED. We also add a small debounce delay of 500ms to avoid registering multiple presses for a single button press.</p>

<p>With these changes, the LED should now toggle its state whenever the push button is pressed.</p>

<p><em>We now use pulse-width modulation to create lighting effects.</em></p>

<p>Pulse-width modulation (PWM) is a technique used to control the brightness of an LED by varying the duty cycle of the signal. Instead of turning the LED fully on or off, PWM switches the LED on and off rapidly, with varying amounts of time spent on and off. This creates the illusion of brightness control, as the LED appears to be dimming or brightening depending on the duty cycle of the signal.</p>

<h1 id="31-aditional-materials">3.1 Aditional materials</h1>

<ul>
  <li>1 x 10k ohm potentiometer</li>
</ul>

<h1 id="32-circuit-diagram">3.2 Circuit Diagram</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                      +------------------+
                     |                  |
                     |    ESP32 Board   |
                     |                  |
                     +------------------+
                              |
                              |
                            10kΩ
                              |
                     +------|&lt;|-------+
                     |      |          |
                     |   GPIO2        |
                     |               |
                     |     LED       |
                     |               |
                     +---------------+

</code></pre></div></div>

<p align="center">
  <img src="/assets/images/post1/4.jpg" width="250" height="250" />
</p>

<h1 id="33-arduino-ide">3.3 Arduino IDE</h1>

<p>No additional steps are required for the Arduino IDE since we have already installed the ESP32 board support package.</p>

<h1 id="33-programming">3.3 Programming</h1>

<p>Here is the code for using pulse-width modulation to create lighting effects on the LED:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Define the LED pin number and PWM frequency</span>
<span class="cp">#define LED_PIN 2
#define PWM_FREQ 5000
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set the LED pin as an output pin</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="c1">// Set the PWM frequency</span>
  <span class="n">ledcSetup</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">PWM_FREQ</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="c1">// Attach the PWM signal to the LED pin</span>
  <span class="n">ledcAttachPin</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Fade the LED on and off</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">dutyCycle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dutyCycle</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">dutyCycle</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Set the LED brightness</span>
    <span class="n">ledcWrite</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dutyCycle</span><span class="p">);</span>
    <span class="c1">// Wait a short period of time</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">dutyCycle</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">dutyCycle</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dutyCycle</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Set the LED brightness</span>
    <span class="n">ledcWrite</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dutyCycle</span><span class="p">);</span>
    <span class="c1">// Wait a short period of time</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In this code, the ledcSetup function is used to set up a PWM channel with a frequency of 5000 Hz and a resolution of 8 bits. The ledcAttachPin function is then used to attach the PWM signal to the LED pin.</p>

<p>The loop function then fades the LED on and off using two for loops. In each loop, the ledcWrite function is used to set the duty cycle of the PWM signal, and the delay function is used to wait a short period of time before changing the duty cycle.</p>

<p>You can adjust the delay time in each loop to change the speed of the fading effect.</p>

<p><em>Finally we proceed to add Wi-Fi connectivity to control the LED via a web interface.</em></p>

<p>To add Wi-Fi connectivity to control the LED via a web interface, we can use the ESP32’s built-in Wi-Fi capabilities and the ESPAsyncWebServer library.</p>

<h1 id="41-aditional-materials">4.1 Aditional materials</h1>

<ul>
  <li>Wi-Fi router</li>
</ul>

<h1 id="42-circuit-diagram">4.2 Circuit Diagram</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                     +--------------------+
                     |                    |
                     |    ESP32 Board     |
                     |                    |
                     +--------------------+
                            |        |
                            |        |                          
                            |        |
                            |        |
                            |        |
                            |        |
                      +------------------+
                      |                  |
                      |        LED       |
                      |                  |
                      +------------------+
                               |
                               |
                              ---
                               |
                              GND

</code></pre></div></div>

<p>In the circuit diagram above, we use the same LED and resistor as before, and connect them to the ESP32 board as shown. We will also need to connect the ESP32 board to a Wi-Fi router to enable it to communicate with other devices over the internet.</p>

<h1 id="43-arduino-ide">4.3 Arduino IDE</h1>

<p>In addition to the steps we took earlier to set up the Arduino IDE for use with the ESP32 board, we will also need to install the WiFi library. To do this, follow these steps:</p>

<ol>
  <li>Open the Arduino IDE.</li>
  <li>Go to Sketch &gt; Include Library &gt; Manage Libraries.</li>
  <li>In the search bar, type “WiFi” and press Enter.</li>
  <li>Find the “WiFi” library by the Arduino team and click “Install”.</li>
</ol>

<h1 id="43-programming">4.3 Programming</h1>

<p>We will now write a program that allows us to control the LED via a web interface hosted on the ESP32 board.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;WiFi.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;WebServer.h&gt;</span><span class="cp">
</span>
<span class="c1">// Define the LED pin number</span>
<span class="cp">#define LED_PIN 2
</span>
<span class="c1">// Replace with your network credentials</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ssid</span> <span class="o">=</span> <span class="s">"XXX"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"XXX"</span><span class="p">;</span>

<span class="n">WebServer</span> <span class="nf">server</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span> <span class="c1">// Create a web server on port 80</span>

<span class="kt">void</span> <span class="nf">handleRoot</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span> <span class="s">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;ESP32 LED Control&lt;/h1&gt;&lt;form method='POST' action='/led'&gt;&lt;button name='state' value='on'&gt;Turn On&lt;/button&gt;&lt;button name='state' value='off'&gt;Turn Off&lt;/button&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleLED</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">state</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">"state"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Received state: "</span> <span class="o">+</span> <span class="n">state</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="s">"on"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="s">"off"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">server</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span> <span class="s">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;ESP32 LED Control&lt;/h1&gt;&lt;p&gt;LED is now "</span> <span class="o">+</span> <span class="n">state</span> <span class="o">+</span> <span class="s">"&lt;/p&gt;&lt;p&gt;&lt;a href='/'&gt;Back&lt;/a&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set the LED pin as an output pin</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>

  <span class="c1">// Connect to Wi-Fi network</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connecting to WiFi..."</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected to WiFi"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"IP address: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span> <span class="c1">// Print the IP address of the board</span>

  <span class="c1">// Start the web server</span>
  <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">handleRoot</span><span class="p">);</span>
  <span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">"/led"</span><span class="p">,</span> <span class="n">handleLED</span><span class="p">);</span>
  <span class="n">server</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"HTTP server started"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Handle incoming client requests</span>
  <span class="n">server</span><span class="p">.</span><span class="n">handleClient</span><span class="p">();</span>  
<span class="p">}</span>

</code></pre></div></div>

<p>This code first defines the LED pin number (LED_PIN) and the network credentials (ssid and password). Then, it creates a web server on port 80. The web server handles requests to the root path (/) and the /led path.</p>

<p>The handleRoot() function is called when a request is made to the root path. This function sends a simple HTML form that allows the user to turn the LED on or off.</p>

<p>The handleLED() function is called when a request is made to the /led path. This function receives the state of the LED (on or off) from the form and sets the LED accordingly. It then sends a simple HTML page that tells the user the current state of the LED.</p>

<p>The setup() function first sets the LED pin as an output pin. Then, it connects to the Wi-Fi network. Once the connection is established, it prints the IP address of the board. Finally, it starts the web server and registers the handleRoot() and handleLED() functions.</p>

<p>The loop() function simply handles incoming client requests.</p>

<p>In the browser, we now should be able to control the LED from the server.</p>

<p align="center">
  <img src="/assets/images/post1/5.png" width="300" height="300" />
</p>

<h1 id="a-flutter-app-to-control-the-led">A Flutter app to control the LED</h1>

<p>To control the LED through a Flutter app, we can create a simple app that sends HTTP requests to the ESP32 web server using the http package.</p>

<p>The following functions define two methods to turn the LED on and off by sending HTTP POST requests to the ESP32 web server:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Future</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;</span> <span class="n">turnOnLED</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
      <span class="kt">Uri</span><span class="o">.</span><span class="na">parse</span><span class="p">(</span><span class="s">'http://&lt;ESP32_IP_ADDRESS&gt;/led'</span><span class="p">),</span>
      <span class="nl">body:</span> <span class="p">{</span><span class="s">'state'</span><span class="o">:</span> <span class="s">'on'</span><span class="p">},</span>
    <span class="p">);</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'Response status: </span><span class="si">${response.statusCode}</span><span class="s">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'Error: </span><span class="si">$e</span><span class="s">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;</span> <span class="n">turnOffLED</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
      <span class="kt">Uri</span><span class="o">.</span><span class="na">parse</span><span class="p">(</span><span class="s">'http://&lt;ESP32_IP_ADDRESS&gt;/led'</span><span class="p">),</span>
      <span class="nl">body:</span> <span class="p">{</span><span class="s">'state'</span><span class="o">:</span> <span class="s">'off'</span><span class="p">},</span>
    <span class="p">);</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'Response status: </span><span class="si">${response.statusCode}</span><span class="s">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'Error: </span><span class="si">$e</span><span class="s">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In these functions, we pass the IP address of the ESP32 board as a parameter and then use it to construct the URL. We replace <ESP32_IP_ADDRESS> with the actual IP address of the ESP32 board.</ESP32_IP_ADDRESS></p>

<p>To create the user interface, we can create a new class that extends the StatefulWidget class. In the build method, we can create a Scaffold widget with an AppBar and two ElevatedButton widgets that call the turnOnLED and turnOffLED functions when pressed.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">LEDControlApp</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">ipAddress</span><span class="p">;</span>

  <span class="n">LEDControlApp</span><span class="p">({</span><span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">ipAddress</span><span class="p">});</span>

  <span class="nd">@override</span>
  <span class="n">_LEDControlAppState</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_LEDControlAppState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_LEDControlAppState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">LEDControlApp</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">MaterialApp</span><span class="p">(</span>
      <span class="nl">title:</span> <span class="s">'LED Control'</span><span class="p">,</span>
      <span class="nl">home:</span> <span class="n">Scaffold</span><span class="p">(</span>
        <span class="nl">appBar:</span> <span class="n">AppBar</span><span class="p">(</span>
          <span class="nl">title:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'LED Control'</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="nl">body:</span> <span class="n">Center</span><span class="p">(</span>
          <span class="nl">child:</span> <span class="n">Column</span><span class="p">(</span>
            <span class="nl">mainAxisAlignment:</span> <span class="n">MainAxisAlignment</span><span class="o">.</span><span class="na">center</span><span class="p">,</span>
            <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
              <span class="n">ElevatedButton</span><span class="p">(</span>
                <span class="nl">onPressed:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">turnOnLED</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">ipAddress</span><span class="p">),</span>
                <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'Turn On'</span><span class="p">),</span>
              <span class="p">),</span>
              <span class="n">ElevatedButton</span><span class="p">(</span>
                <span class="nl">onPressed:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">turnOffLED</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">ipAddress</span><span class="p">),</span>
                <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'Turn Off'</span><span class="p">),</span>
              <span class="p">),</span>
            <span class="p">],</span>
          <span class="p">),</span>
        <span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In this class, we define a constructor that takes the IP address of the ESP32 board as a parameter. In the build method, we pass this IP address to the turnOnLED and turnOffLED functions when the buttons are pressed. We use an anonymous function to wrap the function calls in order to pass the IP address as a parameter.</p>

<p>To use this class, we can create an instance of it and pass the IP address of the ESP32 board as a parameter:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">runApp</span><span class="p">(</span><span class="n">LEDControlApp</span><span class="p">(</span><span class="nl">ipAddress:</span> <span class="s">'&lt;ESP32_IP_ADDRESS&gt;'</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We replace <ESP32_IP_ADDRESS> with the actual IP address of the ESP32 board. When we run this app, we will see a screen with two buttons that allow us to turn the LED on and off.</ESP32_IP_ADDRESS></p>

<h1 id="conclusion">Conclusion</h1>

<p>Throughout the project, we explored some of the basic features of the ESP32 microcontroller, such as controlling a single LED, adding a push button to toggle the LED on and off, and using pulse-width modulation to create different lighting effects. We then added Wi-Fi connectivity and created a web interface to control the LED remotely.</p>

<p>Finally, we showed how to control the LED through a Flutter app by sending HTTP requests to the ESP32 web server using the http package. The simple UI with two buttons to turn the LED on and off provides a convenient way to remotely control the LED. This demonstrates how the ESP32 can be integrated into mobile applications and can be a useful tool for home automation and remote monitoring systems. The ESP32 LED Control project is an excellent starting point for anyone interested in learning about the possibilities of the ESP32 microcontroller.</p>

<p>The ESP32 LED Control project serves to demonstrate my ability to integrate hardware and software to create a functional system, and showcases the versatility of the Arduino IDE in programming different microcontrollers, including the ESP32. This project will serve as a valuable addition to my portfolio and will highlight my skills in embedded systems design and programming. It is also an excellent starting point for anyone interested in learning about the possibilities of the ESP32 microcontroller.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#c" class="page__taxonomy-item p-category" rel="tag">C++</a><span class="sep">, </span>
    
      <a href="/tags/#electronics" class="page__taxonomy-item p-category" rel="tag">electronics</a><span class="sep">, </span>
    
      <a href="/tags/#esp32" class="page__taxonomy-item p-category" rel="tag">ESP32</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#embedded" class="page__taxonomy-item p-category" rel="tag">embedded</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-02-10T00:00:00+00:00">February 10, 2023</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=ESP32+LED+Control%20http%3A%2F%2Flocalhost%3A4000%2Fembedded%2FESP32-LED-Control%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fembedded%2FESP32-LED-Control%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fembedded%2FESP32-LED-Control%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/projects/signal-k/" class="pagination--pager" title="Navigating the Seas with Signal K and Microcontrollers
">Previous</a>
    
    
      <a href="/projects/Building-Embedded-Systems-with-Dart-and-Flutter/" class="pagination--pager" title="IoT Smart Light using an ESP32 and Flutter
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/ESP32-light-sensor/" rel="permalink">Weather Station with ESP32 - Part III
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In this project, we are taking our previous work a step further. We previously utilised a BMP180 sensor to collect data on temperature and pressure, and then...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/XTVTX-module-weather-station-II/" rel="permalink">Weather Station with ESP32 - Part II
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In the previous post, we began the process of building a weather station using an ESP32 board. We selected the BMP180 sensor due to its precise and dependabl...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/ESP32-Temperature-Sensor/" rel="permalink">Weather Station with ESP32 - Part I
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In this project, we have built a weather station using an ESP32 board and a BMP180 sensor. Our goal was to create a custom weather station that is tailored t...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/Building-Embedded-Systems-with-Dart-and-Flutter/" rel="permalink">IoT Smart Light using an ESP32 and Flutter
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Dart and Flutter for Embedded Systems
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/dcoldeira" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/dcoldeira" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://play.google.com/store/apps/details?id=io.dcoldeira.nauticapp" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-google-play" aria-hidden="true"></i> Google Play</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 David Coldeira. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
