<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>IoT Smart Light using an ESP32 and Flutter - C++ Circuits</title>
<meta name="description" content="Dart and Flutter for Embedded Systems">


  <meta name="author" content="David Coldeira">
  
  <meta property="article:author" content="David Coldeira">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="C++ Circuits">
<meta property="og:title" content="IoT Smart Light using an ESP32 and Flutter">
<meta property="og:url" content="http://localhost:4000/projects/Building-Embedded-Systems-with-Dart-and-Flutter/">


  <meta property="og:description" content="Dart and Flutter for Embedded Systems">







  <meta property="article:published_time" content="2023-03-03T00:00:00+00:00">





  

  


<link rel="canonical" href="http://localhost:4000/projects/Building-Embedded-Systems-with-Dart-and-Flutter/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "David Coldeira",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="C++ Circuits Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/icon.png" alt="C++ Circuits"></a>
        
        <a class="site-title" href="/">
          C++ Circuits
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">David Coldeira</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>C++ code examples, insights into the intersection of hardware and software. From object-oriented programming and data structures to algorithms, design patterns, and best practices…</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Bristol</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/dcoldeira" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="IoT Smart Light using an ESP32 and Flutter">
    <meta itemprop="description" content="Dart and Flutter for Embedded Systems">
    <meta itemprop="datePublished" content="2023-03-03T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/projects/Building-Embedded-Systems-with-Dart-and-Flutter/" class="u-url" itemprop="url">IoT Smart Light using an ESP32 and Flutter
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="dart-and-flutter-for-embedded-systems">Dart and Flutter for Embedded Systems</h2>

<p>Dart is a modern, object-oriented programming language created by Google. It’s fast, efficient, and easy to learn. Flutter, on the other hand, is a UI toolkit built on top of Dart that allows you to create beautiful, native applications for mobile, web, and desktop.</p>

<p>One of the key benefits of using Dart and Flutter in embedded systems is the ability to create rich, interactive user interfaces that can be easily updated and customized. This is particularly useful in IoT devices, where user interaction is often limited but still important. By using Flutter, you can create sleek and responsive interfaces that provide real-time feedback and enhance the user experience.</p>

<p>Another benefit is the fact that Dart and Flutter are open source, which means that there are many libraries and resources available for developers to use. This can significantly reduce development time and effort, as well as allow for greater collaboration and knowledge-sharing within the developer community.</p>

<h2 id="using-the-esp32-with-dart-and-flutter">Using the ESP32 with Dart and Flutter</h2>

<p>The ESP32 is a powerful chip that includes built-in Wi-Fi and Bluetooth capabilities. It’s often used in IoT devices, wearables, and robotics, among other applications. By combining the ESP32 with Dart and Flutter, developers can create powerful and flexible embedded systems with rich user interfaces.</p>

<p>One library that can be used for communicating with BLE devices like the ESP32 is flutter_blue_plus. This package provides a simple and intuitive API for scanning for nearby devices, connecting to them, and sending and receiving data.</p>

<p>In this project, we will be utilizing the flutter_blue_plus library to communicate with an ESP32 WROOM 32D board over Bluetooth. We will also be using an LED and a photoresistor to control the brightness of the light. The WROOM-32D is a commonly used variant of the ESP32 module, which includes an onboard antenna, 4MB flash memory, and 520KB SRAM. It also supports Wi-Fi and Bluetooth connectivity, making it an excellent choice for IoT applications.</p>

<p>To program and debug the WROOM-32D board, we will be using Visual Studio Code and the PlatformIO plugin. This IDE supports a wide range of ESP32 boards, including the WROOM-32D, making it easy to get started with our project.</p>

<h2 id="materials">Materials</h2>

<ul>
  <li>ESP32 WROOM D32 development board</li>
  <li>LED (5mm)</li>
  <li>Photoresistor</li>
  <li>Resistors (220Ω and 10kΩ)</li>
  <li>Breadboard</li>
  <li>Jumper wires</li>
  <li>Smartphone with Bluetooth connectivity</li>
  <li>VS Code</li>
</ul>

<p align="center">
  <img src="/assets/images/post3/1.jpg" width="250" height="250" />
</p>

<h2 id="setup">Setup</h2>

<ol>
  <li>Connect the anode (+) of the LED to the GPIO pin 13 on the ESP32 board and the cathode (-) to a 220Ω resistor.</li>
  <li>Connect the other end of the 220Ω resistor to ground.</li>
  <li>Connect one end of the photoresistor to the 3.3V pin on the board.</li>
  <li>Connect the other end of the photoresistor to a 10kΩ resistor.</li>
  <li>Connect the other end of the 10kΩ resistor to the GPIO pin 12 on the board.</li>
  <li>Connect the ground pin on the board to the other end of the 10kΩ resistor.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                      +3.3V
                                         |
                                         |
                                         \
                                         / R1 220Ω
                                         \
                                         |
                                         |
ESP32 GPIO12 ---------------------------|
                                         |
                                         |
                                         \
                                         / LED
                                         \
                                         |
                                         |
ESP32 GPIO34 ---------------------------|
                                         |
                                         |
                                         \
                                         / R2 10K
                                         \
                                         |
                                         |
ESP32 ADC1 (GPIO32) --------------------|
                                         |
                                         |
                                         \
                                         / Photoresistor
                                         \
                                         |
                                         |
GND -------------------------------------+

</code></pre></div></div>

<h2 id="programming">Programming</h2>

<p>This is the C++ code that we have to upload into the board:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;BLEDevice.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;BLEServer.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;BLEUtils.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;BLE2902.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;Arduino.h&gt;</span><span class="cp">
</span>
<span class="c1">// LED pin</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">LED_PIN</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>

<span class="c1">// Photoresistor pin</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">PHOTO_PIN</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>

<span class="c1">// Bluetooth Service and Characteristics UUID</span>
<span class="cp">#define SERVICE_UUID        "4fafc201-1fb5-459e-8fcc-c5c9c331914b"
#define CHAR_UUID           "beb5483e-36e1-4688-b7f5-ea07361b26a8"
</span>
<span class="n">BLECharacteristic</span> <span class="o">*</span><span class="n">pCharacteristic</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">brightness</span> <span class="o">=</span>  <span class="mi">128</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">PHOTO_PIN</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
  
  <span class="c1">// Create a BLE server</span>
  <span class="n">BLEDevice</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="s">"SmartLight"</span><span class="p">);</span>
  <span class="n">BLEServer</span> <span class="o">*</span><span class="n">pServer</span> <span class="o">=</span> <span class="n">BLEDevice</span><span class="o">::</span><span class="n">createServer</span><span class="p">();</span>

  <span class="c1">// Create a BLE service</span>
  <span class="n">BLEService</span> <span class="o">*</span><span class="n">pService</span> <span class="o">=</span> <span class="n">pServer</span><span class="o">-&gt;</span><span class="n">createService</span><span class="p">(</span><span class="n">SERVICE_UUID</span><span class="p">);</span>

  <span class="c1">// Create a BLE characteristic</span>
  <span class="n">pCharacteristic</span> <span class="o">=</span> <span class="n">pService</span><span class="o">-&gt;</span><span class="n">createCharacteristic</span><span class="p">(</span>
                      <span class="n">CHAR_UUID</span><span class="p">,</span>
                      <span class="n">BLECharacteristic</span><span class="o">::</span><span class="n">PROPERTY_READ</span> <span class="o">|</span> <span class="n">BLECharacteristic</span><span class="o">::</span><span class="n">PROPERTY_WRITE</span>
                    <span class="p">);</span>

  <span class="c1">// Create a descriptor</span>
  <span class="n">pCharacteristic</span><span class="o">-&gt;</span><span class="n">addDescriptor</span><span class="p">(</span><span class="k">new</span> <span class="n">BLE2902</span><span class="p">());</span>

  <span class="c1">// Start the service</span>
  <span class="n">pService</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">();</span>

  <span class="c1">// Advertising the service</span>
  <span class="n">BLEAdvertising</span> <span class="o">*</span><span class="n">pAdvertising</span> <span class="o">=</span> <span class="n">pServer</span><span class="o">-&gt;</span><span class="n">getAdvertising</span><span class="p">();</span>
  <span class="n">pAdvertising</span><span class="o">-&gt;</span><span class="n">addServiceUUID</span><span class="p">(</span><span class="n">SERVICE_UUID</span><span class="p">);</span>
  <span class="n">pAdvertising</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">();</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Read the value of the photoresistor</span>
  <span class="kt">int</span> <span class="n">sensorValue</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">PHOTO_PIN</span><span class="p">);</span>
  <span class="n">brightness</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>

  <span class="c1">// Update the LED brightness</span>
  <span class="n">analogWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">brightness</span><span class="p">);</span>

  <span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>
<p>First on this code, we have imported some libraries, including the BLEDevice, BLEServer, and BLEUtils libraries.
The LED_PIN and PHOTO_PIN constants are defined, which represent the pins where the LED and photoresistor are connected, respectively.</p>

<p>The UUIDs for the Bluetooth service and characteristic are defined using the #define preprocessor directive.
A BLECharacteristic pointer named pCharacteristic is declared.</p>

<p>The setup function is defined, which initializes the microcontroller, sets the LED_PIN and PHOTO_PIN pins as output and input, respectively, and creates a BLE server, service, and characteristic. The characteristic is set to have both read and write properties, and a BLE2902 descriptor is added to it. Finally, the service is started and advertised.</p>

<p>The loop function is defined, which reads the value of the photoresistor using the analogRead function, maps the sensorValue from 0-4095 to 0-255, which is the range of brightness for the LED, and updates the LED brightness using the analogWrite function. The function then waits for 50 milliseconds before repeating.</p>

<h2 id="mobile-application">Mobile Application</h2>

<p>In this section we explain how to build an example Flutter app that controls the IoT Smart Light. In this example we are using the flutter_blue_plus library to communicate with the ESP32 over Bluetooth and control the LED brightness using the photoresistor:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'package:flutter/material.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:flutter_blue_plus/flutter_blue_plus.dart'</span><span class="o">;</span>

	<span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">runApp</span><span class="p">(</span><span class="n">MyApp</span><span class="p">());</span>

	<span class="kd">class</span> <span class="nc">MyApp</span> <span class="kd">extends</span> <span class="n">StatelessWidget</span> <span class="p">{</span>
	  <span class="nd">@override</span>
	  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="n">MaterialApp</span><span class="p">(</span>
	      <span class="nl">title:</span> <span class="s">'IoT Smart Light'</span><span class="p">,</span>
	      <span class="nl">theme:</span> <span class="n">ThemeData</span><span class="p">(</span>
		<span class="nl">primarySwatch:</span> <span class="n">Colors</span><span class="o">.</span><span class="na">blue</span><span class="p">,</span>
	      <span class="p">),</span>
	      <span class="nl">home:</span> <span class="n">MyHomePage</span><span class="p">(</span><span class="nl">title:</span> <span class="s">'IoT Smart Light'</span><span class="p">),</span>
	    <span class="p">);</span>
	  <span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">class</span> <span class="nc">MyHomePage</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
	  <span class="n">MyHomePage</span><span class="p">({</span><span class="n">Key</span><span class="o">?</span> <span class="n">key</span><span class="p">,</span> <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="nl">key:</span> <span class="n">key</span><span class="p">);</span>
	  <span class="kd">final</span> <span class="kt">String</span> <span class="n">title</span><span class="p">;</span>

	  <span class="nd">@override</span>
	  <span class="n">_MyHomePageState</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_MyHomePageState</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">class</span> <span class="nc">_MyHomePageState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">MyHomePage</span><span class="p">&gt;</span> <span class="p">{</span>
	  <span class="n">BluetoothDevice</span><span class="o">?</span> <span class="n">_device</span><span class="p">;</span>
	  <span class="n">BluetoothCharacteristic</span><span class="o">?</span> <span class="n">_characteristic</span><span class="p">;</span>
	  <span class="kt">bool</span> <span class="n">_isConnected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	  <span class="kt">bool</span> <span class="n">_isOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	  <span class="kt">int</span> <span class="n">_brightness</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	  <span class="kt">void</span> <span class="n">_connectToDevice</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
	    <span class="c1">// Scan for nearby devices</span>
	    <span class="kd">final</span> <span class="n">devices</span> <span class="o">=</span> <span class="k">await</span> <span class="n">FlutterBlue</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">scan</span><span class="p">(</span><span class="nl">timeout:</span> <span class="n">Duration</span><span class="p">(</span><span class="nl">seconds:</span> <span class="mi">5</span><span class="p">));</span>

	    <span class="c1">// Find the device with the name "ESP32"</span>
	    <span class="kd">final</span> <span class="n">esp32Device</span> <span class="o">=</span> <span class="n">devices</span><span class="o">.</span><span class="na">firstWhere</span><span class="p">(</span>
		<span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">device</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="s">"ESP32"</span><span class="p">,</span>
		<span class="nl">orElse:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">"Could not find device"</span><span class="p">));</span>

	    <span class="c1">// Connect to the device</span>
	    <span class="k">await</span> <span class="n">esp32Device</span><span class="o">.</span><span class="na">connect</span><span class="p">();</span>

	    <span class="c1">// Discover services and characteristics</span>
	    <span class="kd">final</span> <span class="n">services</span> <span class="o">=</span> <span class="k">await</span> <span class="n">esp32Device</span><span class="o">.</span><span class="na">discoverServices</span><span class="p">();</span>
	    <span class="kd">final</span> <span class="n">characteristic</span> <span class="o">=</span> <span class="n">services</span>
		<span class="o">.</span><span class="na">expand</span><span class="p">((</span><span class="n">service</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">service</span><span class="o">.</span><span class="na">characteristics</span><span class="p">)</span>
		<span class="o">.</span><span class="na">firstWhere</span><span class="p">((</span><span class="n">c</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">c</span><span class="o">.</span><span class="na">uuid</span><span class="o">.</span><span class="na">toString</span><span class="p">()</span> <span class="o">==</span> <span class="s">"0000ffe1-0000-1000-8000-00805f9b34fb"</span><span class="p">);</span>

	    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
	      <span class="n">_device</span> <span class="o">=</span> <span class="n">esp32Device</span><span class="p">;</span>
	      <span class="n">_characteristic</span> <span class="o">=</span> <span class="n">characteristic</span><span class="p">;</span>
	      <span class="n">_isConnected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
	    <span class="p">});</span>
	  <span class="p">}</span>

	  <span class="kt">void</span> <span class="n">_disconnectFromDevice</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">_device</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">await</span> <span class="n">_device</span><span class="o">!.</span><span class="na">disconnect</span><span class="p">();</span>
	    <span class="p">}</span>
	    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
	      <span class="n">_device</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	      <span class="n">_characteristic</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	      <span class="n">_isConnected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	      <span class="n">_isOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	      <span class="n">_brightness</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="p">});</span>
	  <span class="p">}</span>

	  <span class="kt">void</span> <span class="n">_toggleLight</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">_isConnected</span> <span class="o">&amp;&amp;</span> <span class="n">_characteristic</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
	      <span class="kd">final</span> <span class="n">newValue</span> <span class="o">=</span> <span class="n">_isOn</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="k">await</span> <span class="n">_characteristic</span><span class="o">!.</span><span class="na">write</span><span class="p">([</span><span class="n">newValue</span><span class="p">]);</span>
	      <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
		<span class="n">_isOn</span> <span class="o">=</span> <span class="o">!</span><span class="n">_isOn</span><span class="p">;</span>
	      <span class="p">});</span>
	    <span class="p">}</span>
	  <span class="p">}</span>

	  <span class="kt">void</span> <span class="n">_updateBrightness</span><span class="p">(</span><span class="kt">int</span> <span class="n">newValue</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">_isConnected</span> <span class="o">&amp;&amp;</span> <span class="n">_characteristic</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">await</span> <span class="n">_characteristic</span><span class="o">!.</span><span class="na">write</span><span class="p">([</span><span class="n">newValue</span><span class="p">]);</span>
	      <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
		<span class="n">_brightness</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">;</span>
	      <span class="p">});</span>
	    <span class="p">}</span>
	  <span class="p">}</span>

	  <span class="nd">@override</span>
	  <span class="kt">void</span> <span class="n">dispose</span><span class="p">()</span> <span class="p">{</span>
	    <span class="n">_disconnectFromDevice</span><span class="p">();</span>
	    <span class="k">super</span><span class="o">.</span><span class="na">dispose</span><span class="p">();</span>
	  <span class="p">}</span>

      <span class="nd">@override</span>
      <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
          <span class="nl">appBar:</span> <span class="n">AppBar</span><span class="p">(</span>
      <span class="nl">title:</span> <span class="n">Text</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="na">title</span><span class="p">),</span>
          <span class="p">),</span>
          <span class="nl">body:</span> <span class="n">Center</span><span class="p">(</span>
      <span class="nl">child:</span> <span class="n">Column</span><span class="p">(</span>
        <span class="nl">mainAxisAlignment:</span> <span class="n">MainAxisAlignment</span><span class="o">.</span><span class="na">center</span><span class="p">,</span>
        <span class="nl">children:</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
          <span class="n">Text</span><span class="p">(</span>
            <span class="s">'Light is </span><span class="si">${_isOn ? 'on' : 'off'}</span><span class="s">'</span><span class="p">,</span>
            <span class="nl">style:</span> <span class="n">TextStyle</span><span class="p">(</span><span class="nl">fontSize:</span> <span class="mi">20</span><span class="p">),</span>
          <span class="p">),</span>
          <span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span> <span class="mi">20</span><span class="p">),</span>
          <span class="n">ElevatedButton</span><span class="p">(</span>
            <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="n">_isConnected</span> <span class="o">?</span> <span class="s">'Disconnect'</span> <span class="o">:</span> <span class="s">'Connect'</span><span class="p">),</span>
            <span class="nl">onPressed:</span> <span class="n">_isConnected</span> <span class="o">?</span> <span class="n">_disconnectFromDevice</span> <span class="o">:</span> <span class="n">_connectToDevice</span><span class="p">,</span>
          <span class="p">),</span>
          <span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span> <span class="mi">20</span><span class="p">),</span>
    <span class="n">Row</span><span class="p">(</span>
      <span class="nl">mainAxisAlignment:</span> <span class="n">MainAxisAlignment</span><span class="o">.</span><span class="na">spaceEvenly</span><span class="p">,</span>
      <span class="nl">children:</span> <span class="p">[</span>
        <span class="n">ElevatedButton</span><span class="p">(</span>
          <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">sendOnMessageToBluetooth</span><span class="p">();</span>
          <span class="p">},</span>
          <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'ON'</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">ElevatedButton</span><span class="p">(</span>
          <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">sendOffMessageToBluetooth</span><span class="p">();</span>
          <span class="p">},</span>
          <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'OFF'</span><span class="p">),</span>
        <span class="p">),</span>
  <span class="p">],</span>
<span class="p">),</span>
<span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span> <span class="mi">20</span><span class="p">),</span>
<span class="n">Row</span><span class="p">(</span>
  <span class="nl">mainAxisAlignment:</span> <span class="n">MainAxisAlignment</span><span class="o">.</span><span class="na">spaceEvenly</span><span class="p">,</span>
  <span class="nl">children:</span> <span class="p">[</span>
    <span class="n">ElevatedButton</span><span class="p">(</span>
      <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
	<span class="n">_updateBrightness</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'25%'</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">ElevatedButton</span><span class="p">(</span>
      <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
	<span class="n">_updateBrightness</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'50%'</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">ElevatedButton</span><span class="p">(</span>
      <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
	<span class="n">_updateBrightness</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'75%'</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">ElevatedButton</span><span class="p">(</span>
      <span class="nl">onPressed:</span> <span class="p">()</span> <span class="p">{</span>
	<span class="n">_updateBrightness</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nl">child:</span> <span class="n">Text</span><span class="p">(</span><span class="s">'100%'</span><span class="p">),</span>
    <span class="p">),</span>
  <span class="p">],</span>
 <span class="p">),</span>
     <span class="p">],</span>
   <span class="p">),</span>
  <span class="p">),</span>
 <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sendOnMessageToBluetooth</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="n">_isConnected</span> <span class="o">&amp;&amp;</span> <span class="n">_characteristic</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<span class="k">await</span> <span class="n">_characteristic</span><span class="o">!.</span><span class="na">write</span><span class="p">([</span><span class="mi">1</span><span class="p">]);</span>
<span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
<span class="n">_isOn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sendOffMessageToBluetooth</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="n">_isConnected</span> <span class="o">&amp;&amp;</span> <span class="n">_characteristic</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<span class="k">await</span> <span class="n">_characteristic</span><span class="o">!.</span><span class="na">write</span><span class="p">([</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
<span class="n">_isOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
<span class="p">}</span>
<span class="p">}</span>
  <span class="p">}</span>

</code></pre></div></div>

<p>The MyHomePage widget is a stateful widget that defines the UI of the home screen. It has a <code class="language-plaintext highlighter-rouge">BluetoothDevice</code> variable <code class="language-plaintext highlighter-rouge">_device</code>, a <code class="language-plaintext highlighter-rouge">BluetoothCharacteristic</code> variable <code class="language-plaintext highlighter-rouge">_characteristic</code>, a boolean variable <code class="language-plaintext highlighter-rouge">_isConnected</code> to keep track of the connection status, a boolean variable <code class="language-plaintext highlighter-rouge">_isOn</code> to keep track of the light’s on/off status, and an integer variable <code class="language-plaintext highlighter-rouge">_brightness</code> to keep track of the light’s brightness level.</p>

<p>There are several functions defined within the <code class="language-plaintext highlighter-rouge">_MyHomePageState</code> class, including <code class="language-plaintext highlighter-rouge">_connectToDevice()</code>, <code class="language-plaintext highlighter-rouge">_disconnectFromDevice()</code>, <code class="language-plaintext highlighter-rouge">_toggleLight()</code>, and <code class="language-plaintext highlighter-rouge">_updateBrightness()</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">_connectToDevice()</code> function scans for nearby Bluetooth devices and connects to the ESP32 device that has the name “ESP32”. It then discovers the services and characteristics of the device and sets the <code class="language-plaintext highlighter-rouge">_device</code>, <code class="language-plaintext highlighter-rouge">_characteristic</code>, and <code class="language-plaintext highlighter-rouge">_isConnected</code> variables accordingly.</p>

<p>The <code class="language-plaintext highlighter-rouge">_disconnectFromDevice()</code> function disconnects from the connected device and resets the <code class="language-plaintext highlighter-rouge">_device</code>, <code class="language-plaintext highlighter-rouge">_characteristic</code>, <code class="language-plaintext highlighter-rouge">_isConnected</code>, <code class="language-plaintext highlighter-rouge">_isOn</code>, and <code class="language-plaintext highlighter-rouge">_brightness</code> variables.</p>

<p>The <code class="language-plaintext highlighter-rouge">_toggleLight()</code> function writes a new value to the <code class="language-plaintext highlighter-rouge">_characteristic</code> to turn the light on or off, depending on its current state. It then updates the <code class="language-plaintext highlighter-rouge">_isOn</code> variable accordingly.</p>

<p>The <code class="language-plaintext highlighter-rouge">_updateBrightness()</code> function writes a new value to the <code class="language-plaintext highlighter-rouge">_characteristic</code> to update the light’s brightness level. It then updates the <code class="language-plaintext highlighter-rouge">_brightness</code> variable accordingly.</p>

<p>The <code class="language-plaintext highlighter-rouge">build()</code> method defines the layout of the home screen using a <code class="language-plaintext highlighter-rouge">Scaffold</code> widget, an <code class="language-plaintext highlighter-rouge">AppBar</code> widget, and a <code class="language-plaintext highlighter-rouge">Column</code> widget. The UI consists of a text widget that displays the current state of the light, two <code class="language-plaintext highlighter-rouge">ElevatedButton</code> widgets that allow the user to connect or disconnect from the device, and four <code class="language-plaintext highlighter-rouge">ElevatedButton</code> widgets that allow the user to turn the light on or off and adjust its brightness level.</p>

<p>The <code class="language-plaintext highlighter-rouge">sendOnMessageToBluetooth()</code> and <code class="language-plaintext highlighter-rouge">sendOffMessageToBluetooth()</code> functions are used to send messages to the connected device to turn the light on or off, respectively. They are called when the user taps the corresponding <code class="language-plaintext highlighter-rouge">ElevatedButton</code> widgets on the UI.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this project, we have demonstrated how to use Dart and Flutter with an ESP32 board to create an IoT smart light. We have shown how Dart and Flutter can be used to build an intuitive mobile app that communicates with the ESP32 board over Bluetooth and controls the brightness of an LED using a photoresistor.</p>

<p>By using Dart and Flutter, we were able to create a modern and responsive user interface that allows for real-time feedback and customization. We also utilized the built-in Wi-Fi and Bluetooth capabilities of the ESP32 board to create a flexible and powerful embedded system.</p>

<p>Overall, this project highlights the potential of combining modern programming languages and frameworks with embedded systems to create innovative IoT solutions. With the increasing demand for smart devices and connected systems, this project provides a useful example of how developers can leverage their skills to create exciting and impactful projects in the IoT space.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#dart" class="page__taxonomy-item p-category" rel="tag">Dart</a><span class="sep">, </span>
    
      <a href="/tags/#embedded-systems" class="page__taxonomy-item p-category" rel="tag">embedded systems</a><span class="sep">, </span>
    
      <a href="/tags/#esp32" class="page__taxonomy-item p-category" rel="tag">ESP32</a><span class="sep">, </span>
    
      <a href="/tags/#flutter" class="page__taxonomy-item p-category" rel="tag">Flutter</a><span class="sep">, </span>
    
      <a href="/tags/#mobile-app" class="page__taxonomy-item p-category" rel="tag">mobile app</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#projects" class="page__taxonomy-item p-category" rel="tag">projects</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-03-03T00:00:00+00:00">March 3, 2023</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=IoT+Smart+Light+using+an+ESP32+and+Flutter%20http%3A%2F%2Flocalhost%3A4000%2Fprojects%2FBuilding-Embedded-Systems-with-Dart-and-Flutter%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fprojects%2FBuilding-Embedded-Systems-with-Dart-and-Flutter%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fprojects%2FBuilding-Embedded-Systems-with-Dart-and-Flutter%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/embedded/ESP32-LED-Control/" class="pagination--pager" title="ESP32 LED Control
">Previous</a>
    
    
      <a href="/projects/ESP32-Temperature-Sensor/" class="pagination--pager" title="Weather Station with ESP32 - Part I
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/ESP32-light-sensor/" rel="permalink">Weather Station with ESP32 - Part III
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In this project, we are taking our previous work a step further. We previously utilised a BMP180 sensor to collect data on temperature and pressure, and then...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/XTVTX-module-weather-station-II/" rel="permalink">Weather Station with ESP32 - Part II
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In the previous post, we began the process of building a weather station using an ESP32 board. We selected the BMP180 sensor due to its precise and dependabl...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/ESP32-Temperature-Sensor/" rel="permalink">Weather Station with ESP32 - Part I
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In this project, we have built a weather station using an ESP32 board and a BMP180 sensor. Our goal was to create a custom weather station that is tailored t...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/embedded/ESP32-LED-Control/" rel="permalink">ESP32 LED Control
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          12 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">This project shows some of the features of the powerful ESP32 microcontroller. Starting with a simple LED circuit, we demonstrate how to control it using cod...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/dcoldeira" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/dcoldeira" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://play.google.com/store/apps/details?id=io.dcoldeira.nauticapp" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-google-play" aria-hidden="true"></i> Google Play</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 David Coldeira. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
