<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 350">
  <!-- Title -->
  <text x="450" y="30" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Stage 2: MBQC Compilation Pipeline
  </text>

  <!-- Phase 1: Graph Extraction -->
  <g id="phase1">
    <rect x="50" y="70" width="220" height="220" fill="#e8f5e9" stroke="#4caf50" stroke-width="3" rx="10"/>
    <text x="160" y="95" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#2e7d32">
      Phase 1: Graph Extraction
    </text>

    <!-- Input -->
    <rect x="70" y="115" width="180" height="35" fill="#fff" stroke="#4caf50" stroke-width="2" rx="5"/>
    <text x="160" y="138" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#424242">
      QuantumRelation
    </text>

    <!-- Arrow -->
    <path d="M 160 155 L 160 175" stroke="#4caf50" stroke-width="2" marker-end="url(#arrow-green)"/>

    <!-- Process -->
    <rect x="70" y="180" width="180" height="35" fill="#c8e6c9" stroke="#4caf50" stroke-width="2" rx="5"/>
    <text x="160" y="203" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#2e7d32" font-weight="bold">
      extract_graph()
    </text>

    <!-- Arrow -->
    <path d="M 160 220 L 160 240" stroke="#4caf50" stroke-width="2" marker-end="url(#arrow-green)"/>

    <!-- Output -->
    <rect x="70" y="245" width="180" height="35" fill="#fff" stroke="#4caf50" stroke-width="2" rx="5"/>
    <text x="160" y="268" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#424242">
      Graph State
    </text>

    <!-- Details -->
    <text x="160" y="310" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      Detects: Edge, Star, Ring
    </text>
  </g>

  <!-- Arrow between phases -->
  <path d="M 275 180 L 315 180" stroke="#9e9e9e" stroke-width="3" marker-end="url(#arrow-gray)"/>

  <!-- Phase 2: Pattern Generation -->
  <g id="phase2">
    <rect x="320" y="70" width="220" height="220" fill="#e3f2fd" stroke="#2196f3" stroke-width="3" rx="10"/>
    <text x="430" y="95" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#1565c0">
      Phase 2: Pattern Generation
    </text>

    <!-- Input -->
    <rect x="340" y="115" width="180" height="35" fill="#fff" stroke="#2196f3" stroke-width="2" rx="5"/>
    <text x="430" y="138" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#424242">
      Graph State
    </text>

    <!-- Arrow -->
    <path d="M 430 155 L 430 175" stroke="#2196f3" stroke-width="2" marker-end="url(#arrow-blue)"/>

    <!-- Process -->
    <rect x="340" y="180" width="180" height="35" fill="#bbdefb" stroke="#2196f3" stroke-width="2" rx="5"/>
    <text x="430" y="203" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#1565c0" font-weight="bold">
      generate_pattern()
    </text>

    <!-- Arrow -->
    <path d="M 430 220 L 430 240" stroke="#2196f3" stroke-width="2" marker-end="url(#arrow-blue)"/>

    <!-- Output -->
    <rect x="340" y="245" width="180" height="35" fill="#fff" stroke="#2196f3" stroke-width="2" rx="5"/>
    <text x="430" y="268" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#424242">
      MeasurementPattern
    </text>

    <!-- Details -->
    <text x="430" y="305" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      Preparation, Entanglement,
    </text>
    <text x="430" y="318" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      Measurements, Corrections
    </text>
  </g>

  <!-- Arrow between phases -->
  <path d="M 545 180 L 585 180" stroke="#9e9e9e" stroke-width="3" marker-end="url(#arrow-gray)"/>

  <!-- Phase 3: Adaptive Corrections -->
  <g id="phase3">
    <rect x="590" y="70" width="260" height="220" fill="#fce4ec" stroke="#e91e63" stroke-width="3" rx="10"/>
    <text x="720" y="95" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#c2185b">
      Phase 3: Adaptive Corrections
    </text>

    <!-- Input -->
    <rect x="610" y="115" width="220" height="35" fill="#fff" stroke="#e91e63" stroke-width="2" rx="5"/>
    <text x="720" y="138" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#424242">
      MeasurementPattern
    </text>

    <!-- Arrow -->
    <path d="M 720 155 L 720 175" stroke="#e91e63" stroke-width="2" marker-end="url(#arrow-pink)"/>

    <!-- Process -->
    <rect x="610" y="180" width="220" height="35" fill="#f8bbd0" stroke="#e91e63" stroke-width="2" rx="5"/>
    <text x="720" y="203" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#c2185b" font-weight="bold">
      apply_corrections()
    </text>

    <!-- Arrow -->
    <path d="M 720 220 L 720 240" stroke="#e91e63" stroke-width="2" marker-end="url(#arrow-pink)"/>

    <!-- Output -->
    <rect x="610" y="245" width="220" height="35" fill="#fff" stroke="#e91e63" stroke-width="2" rx="5"/>
    <text x="720" y="268" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#424242">
      Executable MBQC
    </text>

    <!-- Details -->
    <text x="720" y="305" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      Teleportation, Corrections
    </text>
    <text x="720" y="318" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
      Fidelity > 0.95
    </text>
  </g>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4caf50" />
    </marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#2196f3" />
    </marker>
    <marker id="arrow-pink" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e91e63" />
    </marker>
    <marker id="arrow-gray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#9e9e9e" />
    </marker>
  </defs>
</svg>
